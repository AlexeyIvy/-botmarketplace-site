# Foundation v1 — минимальный надёжный скелет

Документ фиксирует практический план запуска проекта без «лишней философии»:
- минимальная полезность в каждом блоке продукта;
- безопасный торговый контур;
- понятные шаги, которые можно выполнить и проверить по одному;
- архитектура, пригодная для последующего наращивания функционала.

## 1) Продуктовые блоки (минимум в каждом)

## 1.1 Terminal (минимум)
**Цель:** пользователь видит рынок и может сделать базовую ручную сделку в demo.

MVP-поставка:
- выбор `linear` инструмента;
- свечи + текущая цена;
- подключение demo API ключей;
- ручной ордер `Market/Limit`;
- обязательные SL/TP при открытии позиции.

## 1.2 Research Lab (минимум)
**Цель:** пользователь может формализовать идею и проверить её на базовом историческом тесте.

MVP-поставка:
- редактор Strategy DSL + валидация schema;
- базовый исторический replay/backtest по свечам;
- минимальный отчёт: количество сделок, winrate, PnL, max drawdown;
- запуск стратегии в demo-forward режиме (ограниченный runtime) без сложной оптимизации.

## 1.3 Bot Factory (минимум)
**Цель:** из проверенной стратегии создать и запустить бота.

MVP-поставка:
- создать бота из версии Strategy DSL;
- задать risk/execution параметры;
- старт/стоп/timeout;
- журнал событий выполнения (state transitions + ошибки).

---

## 2) Риск-политика (решение по умолчанию)

Принцип: **user-selectable safe policy** (пользователь выбирает режим), но с безопасным дефолтом.

Режимы:
1. `strict` (по умолчанию): если SL/TP не выставлены после повторных попыток -> аварийное закрытие позиции market и/или `PAUSED`.
2. `pause-only`: без авто-выхода, но стратегия уходит в `PAUSED` и требует ручного действия.

MUST:
- режим риска задаётся в конфиге стратегии/бота;
- режим логируется в `BotEvent`;
- UI явно показывает выбранную политику.

---

## 3) Подход к срокам

Главный критерий — **чёткие, короткие, проверяемые шаги**, а не фиксированный календарный дедлайн.

Правило шага:
- входит в контекстное окно CloudCode;
- имеет начало/конец;
- имеет однозначный артефакт результата;
- имеет команду(ы) проверки и критерий приёмки.

Рекомендуемый размер шага: 0.5–1 рабочий день.

---

## 4) UI-приоритет

Решение:
- сначала **рабочий и простой UI**,
- без блокировки будущего редизайна.

Технические ограничения для «неблокирующего MVP UI»:
- разделение design tokens/темы и бизнес-логики;
- отсутствие жёстких связок данных с конкретной версткой;
- стабильные API-контракты между UI и backend.

---

## 5) Этапы Foundation v1

Сводный roadmap по всем этапам проекта: `docs/21-project-stages.md`.

## Этап A — Platform bootstrap
Результат:
- базовый backend API каркас (`healthz`, `readyz`, auth stub);
- базовая схема БД и миграции;
- каркас frontend с роутами `Terminal / Lab / Factory`.

Проверки:
- API отвечает на health/readiness;
- миграции применяются локально;
- UI открывает все 3 раздела.

## Этап B — Terminal core
Результат:
- instruments/candles/ticker;
- подключение demo ключей;
- ручной `Market/Limit` + SL/TP.

Проверки:
- успешный сценарий «подключил ключ -> отправил ордер -> увидел статус»;
- некорректный ввод корректно валидируется и возвращает Problem Details.

## Этап C — Strategy & validation core
Результат:
- CRUD стратегий;
- schema validation;
- версионирование spec.

Проверки:
- валидная стратегия сохраняется;
- невалидная отклоняется с понятной ошибкой и pointer.

## Этап D — Bot runtime core
Результат:
- state machine + reconciliation;
- idempotency (`intentId`, `orderLinkId`);
- event log.

Проверки:
- restart/reconnect сценарий возвращает runtime в согласованное состояние;
- повторная отправка intent не создаёт дубль ордера.

## Этап E — Lab minimum
Результат:
- исторический replay по свечам;
- минимальные метрики;
- demo-forward запуск стратегии с ограничением времени.

Проверки:
- отчёт формируется детерминированно на одинаковом наборе данных;
- demo-forward события пишутся в журнал.

## Этап F — Hardening
Результат:
- rate limiting, pause-on-error, runbooks, backup/restore check;
- release checklist для MVP baseline.

Проверки:
- smoke-test на demo;
- базовые аварийные сценарии отрабатываются по runbook.
